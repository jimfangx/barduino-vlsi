# Generate Make include to aid in flow
vlsi.core.build_system: make

# LVS blackbox srams due to spice being on bwrc servers -- will be copied over once jim gets access, do not blackbox SRAMs for DRC since they'll not be blackboxed by cadence -- any bugs in the srams should be reported to SRAM22 authors
technology.sky130.drc_blackbox_srams: false
technology.sky130.lvs_blackbox_srams: true

# Hammer will auto-generate a CPF for simple power designs; see hammer/src/hammer-vlsi/defaults.yml for more info
vlsi.inputs.power_spec_mode: auto
vlsi.inputs.power_spec_type: cpf
# Power Straps
par.power_straps_mode: manual
# add_stripes -nets {VDD VSS} -pin_layer met1 -layer met1 -start_offset .2 -width .4 -spacing 3.74 -set_to_set_distance 8.28 -pad_core_ring_bottom_layer_limit met1 -pad_core_ring_top_layer_limit met1 -direction horizontal -block_ring_top_layer_limit met1 -block_ring_bottom_layer_limit met1 -snap_wire_center_to_grid none is from power_rail_straps_no_tapcells() in __init__.py
par.power_straps_script_contents: >
  reset_db -category add_stripes

  set_db add_stripes_stacked_via_bottom_layer met1

  set_db add_stripes_stacked_via_top_layer met1

  set_db add_stripes_spacing_from_block 4.000

  add_stripes -pin_layer met1 -layer met1 -over_pins 1 -master "sky130_fd_sc_hd__tapvpwrvgnd_1" -block_ring_bottom_layer_limit met1 -block_ring_top_layer_limit met1 -pad_core_ring_bottom_layer_limit met1 -pad_core_ring_top_layer_limit met1 -direction horizontal -width pin_width -nets { VSS VDD }


  reset_db -category add_stripes

  set_db add_stripes_stacked_via_top_layer met2

  set_db add_stripes_stacked_via_bottom_layer met1

  set_db add_stripes_trim_antenna_back_to_shape {stripe}

  set_db add_stripes_spacing_from_block 4.000

  add_stripes -create_pins 0 -block_ring_bottom_layer_limit met2 -block_ring_top_layer_limit met1 -direction vertical -layer met2 -nets {VSS VDD} -pad_core_ring_bottom_layer_limit met1 -set_to_set_distance 82.80 -spacing 2.26 -switch_layer_over_obs 0 -width 0.96 -area [get_db designs .core_bbox] -start [expr [lindex [lindex [get_db designs .core_bbox] 0] 0] + 5.04]

  add_stripes -create_pins 0 -block_ring_bottom_layer_limit met2 -block_ring_top_layer_limit met1 -direction vertical -layer met2 -nets {VSS VDD} -pad_core_ring_bottom_layer_limit met1 -set_to_set_distance 82.80 -spacing 2.26 -switch_layer_over_obs 0 -width 0.96 -area [get_db designs .core_bbox] -start 3328.0


  reset_db -category add_stripes

  set_db add_stripes_stacked_via_top_layer met3

  set_db add_stripes_stacked_via_bottom_layer met2

  set_db add_stripes_trim_antenna_back_to_shape {stripe}

  set_db add_stripes_spacing_from_block 2.000

  add_stripes -create_pins 0 -block_ring_bottom_layer_limit met3 -block_ring_top_layer_limit met2 -direction horizontal -layer met3 -nets {VSS VDD} -pad_core_ring_bottom_layer_limit met2 -set_to_set_distance 14.96 -spacing 3.62 -switch_layer_over_obs 0 -width 1.14 -area [get_db designs .core_bbox] -start [expr [lindex [lindex [get_db designs .core_bbox] 0] 1] + 7.59]


  reset_db -category add_stripes

  set_db add_stripes_stacked_via_top_layer met4

  set_db add_stripes_stacked_via_bottom_layer met3

  set_db add_stripes_trim_antenna_back_to_shape {stripe}

  set_db add_stripes_spacing_from_block 2.000

  add_stripes -create_pins 0 -block_ring_bottom_layer_limit met4 -block_ring_top_layer_limit met3 -direction vertical -layer met4 -nets {VSS VDD} -pad_core_ring_bottom_layer_limit met3 -set_to_set_distance 20.24 -spacing 4.58 -switch_layer_over_obs 0 -width 1.86 -area [get_db designs .core_bbox] -start [expr [lindex [lindex [get_db designs .core_bbox] 0] 0] + 10.11]


  reset_db -category add_stripes

  set_db add_stripes_stacked_via_top_layer met5

  set_db add_stripes_stacked_via_bottom_layer met4

  set_db add_stripes_trim_antenna_back_to_shape {stripe}

  set_db add_stripes_spacing_from_block 2.000

  add_stripes -create_pins 1 -block_ring_bottom_layer_limit met5 -block_ring_top_layer_limit met4 -direction horizontal -layer met5 -nets {VSS VDD} -pad_core_ring_bottom_layer_limit met4 -set_to_set_distance 61.2 -spacing 18.4 -switch_layer_over_obs 0 -width 5.4 -area [get_db designs .core_bbox] -start [expr [lindex [lindex [get_db designs .core_bbox] 0] 1] + 7.5]

vlsi.inputs:
  power_spec_type: cpf
  power_spec_mode: manual
  power_spec_contents_meta: transclude
  power_spec_contents: ./ofo.cpf
  supplies:
    # Hammer should only know about the main core power nets
    # Other pins/nets/domains handled in CPF
    power:
      - {name: "VDD",  pins: ["VDD"]}
    ground:
      - {name: "VSS",  pins: ["VSS"]}
    VDD: "1.8 V"
    GND: "0 V"

  top_module: ChipTop

  clocks:
    # primary clock (for all TL busses)
    - {name: "clock", path: "clock", period: "30ns", uncertainty: "0.1ns"}
    # serial tl clock
    - {name: "tl_clock", path: "iocell_serial_tl_clock_in/iocell/IN", period: "200ns", uncertainty: "0.1ns"}
    # jtag clock
    - {name: "jtag_TCK", path: "iocell_jtag_TCK/iocell/IN", period: "200ns", uncertainty: "1ns"}


  placement_constraints:
    - path: ChipTop
      type: toplevel
      x: 0
      y: 0
      width: 3588
      height: 5188
      margins: {left: 249.78, right: 249.78, top: 252.08, bottom: 252.08}
    - path: "ChipTop/system/tile_prci_domain/element_reset_domain_rockettile/frontend/icache/rockettile_icache_data_arrays_1_0/rockettile_icache_data_arrays_0_0_ext/mem_0_0"
      type: hardmacro
      x: 500
      y: 1550
      orientation: my90
      top_layer: met2
    - path: "ChipTop/system/tile_prci_domain/element_reset_domain_rockettile/frontend/icache/rockettile_icache_data_arrays_0_0/rockettile_icache_data_arrays_0_0_ext/mem_0_0"
      type: hardmacro
      x: 500
      y: 855
      orientation: my90
      top_layer: met2
    - path: "ChipTop/system/tile_prci_domain/element_reset_domain_rockettile/dcache/data/rockettile_dcache_data_arrays_0/rockettile_dcache_data_arrays_0_ext/mem_0_0"
      type: hardmacro
      x: 500
      y: 2151
      orientation: my90
      top_layer: met2
    - path: "ChipTop/system/tile_prci_domain/element_reset_domain_rockettile/dcache/rockettile_dcache_tag_array_0/rockettile_dcache_tag_array_0_ext/mem_0_0"
      type: hardmacro
      x: 500
      y: 3076
      orientation: my90
      top_layer: met2
    - path: "ChipTop/system/tile_prci_domain/element_reset_domain_rockettile/frontend/icache/rockettile_icache_tag_array_0/rockettile_icache_tag_array_0_ext/mem_0_0"
      type: hardmacro 
      x: 1250
      y: 3076
      orientation: my90
    # for the por
    - path: ChipTop/system
      type: obstruction
      obs_types: [power, place, route]
      layers: [met1]
      x: 3243
      y: 252
      width: 34
      height: 48
  # custom sdc constraints to set_false_path
  custom_sdc_constraints: [
    # "set_false_path -from reset -to system/chipyard_prcictrl_domain/clockDivider/divider_io_resetAsync_stretcher/resetout/reg_0_reg/CK"
    "set_false_path -from reset"
  ]
  dont_use_mode: append
  dont_use_list_meta: append
  # some Cadence std cells have DRC violations in them :( - CLKINV1 and CLKBUFX2 will prob hurt QoR a lot, these are used by CTS a lot.. also as a rule of thumb disabling any X1 cells is not a great idea for QoR
  dont_use_list:
    - sky130_fd_sc_hvl__*
    - CLKINVX1
    - CLKBUFX2
    - DLY4X4
    - DFFRX1

design.def.hv_routing_meta: prependlocal
design.def.hv_routing: ofo-hv-routing.def
